{{ define "main" }}
<!-- Fixed Header with Logo -->
<header class="header">
    <div class="watermark">
        <span class="watermark-name">Rahul Matthan</span>
        <span class="watermark-tagline">Photography</span>
    </div>
</header>

<!-- Image Display Area -->
<div class="gallery" id="gallery">
    {{ $imagePath := "static/images" }}
    {{ $captions := site.Data.captions }}

    {{ if (fileExists $imagePath) }}
    {{ $files := readDir $imagePath }}

    {{/* Collect valid images */}}
    {{ $images := slice }}
    {{ range $files }}
    {{ if not .IsDir }}
    {{ $lowerName := lower .Name }}
    {{ if or (strings.HasSuffix $lowerName ".jpg") (strings.HasSuffix $lowerName ".jpeg") (strings.HasSuffix $lowerName ".png") (strings.HasSuffix $lowerName ".webp") }}
    {{ $images = $images | append . }}
    {{ end }}
    {{ end }}
    {{ end }}

    {{/* Shuffle images randomly */}}
    {{ $images = shuffle $images }}

    {{ $imageIndex := 0 }}
    {{ range $images }}
    {{/* Parse filename for caption: Location, Year—Title.jpg */}}
    {{ $baseName := replaceRE "(?i)\\.(jpg|jpeg|png|webp)$" "" .Name }}
    {{ $parts := split $baseName "—" }}
    {{ $hasFilenameCaption := gt (len $parts) 1 }}
    {{ $caption := index $captions .Name }}
    <div class="slide {{ if eq $imageIndex 0 }}active{{ end }}"
         data-index="{{ $imageIndex }}"
         {{ if $hasFilenameCaption }}data-location="{{ index $parts 0 }}" data-details="{{ index $parts 1 }}"{{ else if $caption }}data-location="{{ $caption.location }}" data-details="{{ $caption.details }}"{{ end }}>
        <img src="{{ printf "/images/%s" .Name }}" alt="{{ .Name }}">
    </div>
    {{ $imageIndex = add $imageIndex 1 }}
    {{ end }}

    {{ if eq (len $images) 0 }}
    <div class="placeholder-msg">
        <h2>Gallery Empty</h2>
        <p>No images found in <code>static/images/</code>.</p>
        <p>Please drop your .jpg or .png photos directly into the <code>static/images/</code> folder.</p>
    </div>
    {{ end }}

    {{ else }}
    <div class="placeholder-msg">
        <p>No <code>static/images</code> folder found. Please create it and add images.</p>
    </div>
    {{ end }}
</div>

<!-- Fixed Footer with Caption -->
<footer class="footer">
    <div class="caption" id="caption">
        <span class="caption-location" id="caption-location"></span>
        <span class="caption-details" id="caption-details"></span>
    </div>
</footer>

<!-- Hover Zones for Arrows -->
<div class="hover-zone hover-zone-left" id="hover-left">
    <button class="arrow arrow-left" id="arrow-left" aria-label="Previous image">&#8249;</button>
</div>
<div class="hover-zone hover-zone-right" id="hover-right">
    <button class="arrow arrow-right" id="arrow-right" aria-label="Next image">&#8250;</button>
</div>
{{ end }}
